---
import Layout from "../layouts/Main.astro";
import bee from "../assets/bee.avif";
import { getCollection } from "astro:content";

// Get the most recent news article
const allNews = await getCollection("news");
const sortedNews = allNews.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const latestNews = sortedNews[0];

// Get meetings
const allMeetings = await getCollection("meetings");
const now = new Date();

// Get the most recent past meeting
const pastMeetings = allMeetings
	.filter((meeting) => meeting.data.date < now)
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestPastMeeting = pastMeetings[0];

// Get the next upcoming meeting
const upcomingMeetings = allMeetings
	.filter((meeting) => meeting.data.date >= now)
	.sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());
const nextMeeting = upcomingMeetings[0];

// Format date helper
const formatDate = (date: Date) => {
	return date.toLocaleDateString("en-GB", {
		day: "numeric",
		month: "long",
		year: "numeric",
	});
};
---

<Layout
	title="Welcome to Dover & District Beekeepers' Association"
	description="Supporting beekeepers in South East Kent since 1939. Join us for meetings, training, and advice on beekeeping, swarms, and Asian Hornets."
	image={bee.src}
>
	<div class="flex flex-col md:flex-row items-center gap-8 md:gap-12 pb-10">
		<!-- Text Content -->
		<div class="flex-1 text-center md:text-left">
			<h1
				class="text-3xl md:text-4xl lg:text-5xl font-bold text-amber-600 leading-tight"
			>
				Welcome to Dover & District Beekeepers' Association
			</h1>
			<div
				class="text-xl md:text-2xl text-gray-700 dark:text-gray-200 leading-relaxed max-w-2xl"
			>
				<p>
					Are you interested in keeping bees? Want to know more about honey?
					Have a swarm in your garden? Think you've spotted an Yellow-Legged
					Asian Hornet?
				</p>
			</div>

			<!-- CTA Buttons -->
			<div
				class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-4"
			>
				<a
					href="/membership"
					class="inline-block px-8 py-3 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-amber-700 transition-colors text-center"
				>
					Join Us
				</a>
				<a
					href="/contact"
					class="inline-block px-8 py-3 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 transition-colors text-center"
				>
					Contact Us
				</a>
				<a
					href="/swarms"
					class="inline-block px-8 py-3 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 transition-colors text-center"
				>
					Swarms
				</a>
				<a
					href="/hornets"
					class="inline-block px-8 py-3 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 transition-colors text-center"
				>
					Yellow-Legged Asian Hornets
				</a>
			</div>
		</div>

		<!-- Hero Image -->
		<div class="flex-1 w-full max-w-lg md:max-w-none">
			<img
				src={bee.src}
				alt="Honey bee on a flower"
				class="w-full h-auto rounded-2xl shadow-xl transform hover:scale-[1.02] transition-transform duration-300"
			/>
		</div>
	</div>

	<!-- Features / Quick Links Section -->
	<div class="grid md:grid-cols-3 gap-8 py-10 border-t border-gray-200">
		<!-- Latest News -->
		{
			latestNews && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">Latest News</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(latestNews.data.pubDate)}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{latestNews.data.title}
					</p>
					<a
						href={`/news/${latestNews.id}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						Read more &rarr;
					</a>
				</div>
			)
		}

		<!-- Most Recent Past Meeting -->
		{
			latestPastMeeting && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">
						Most Recent Meeting
					</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(latestPastMeeting.data.date)}
						{latestPastMeeting.data.time && ` • ${latestPastMeeting.data.time}`}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{latestPastMeeting.data.title}
					</p>
					<a
						href={`/meetings/${latestPastMeeting.id}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						View details &rarr;
					</a>
				</div>
			)
		}

		<!-- Next Upcoming Meeting -->
		{
			nextMeeting && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">Next Meeting</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(nextMeeting.data.date)}
						{nextMeeting.data.time && ` • ${nextMeeting.data.time}`}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{nextMeeting.data.title}
					</p>
					<a
						href={`/meetings/${nextMeeting.id}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						View details &rarr;
					</a>
				</div>
			)
		}
	</div>
</Layout>
