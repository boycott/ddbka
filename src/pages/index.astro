---
import Layout from "../layouts/Main.astro";
import bee from "../assets/bee.avif";
import { getCollection } from "astro:content";

// Get the most recent news article
const allNews = await getCollection("news");
const sortedNews = allNews.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const latestNews = sortedNews[0];

// Get meetings
const allMeetings = await getCollection("meetings");
const now = new Date();

// Get the most recent past meeting
const pastMeetings = allMeetings
	.filter((meeting) => meeting.data.date < now)
	.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const latestPastMeeting = pastMeetings[0];

// Get the next upcoming meeting
const upcomingMeetings = allMeetings
	.filter((meeting) => meeting.data.date >= now)
	.sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());
const nextMeeting = upcomingMeetings[0];

// Format date helper
const formatDate = (date: Date) => {
	return date.toLocaleDateString("en-GB", {
		day: "numeric",
		month: "long",
		year: "numeric",
	});
};
---

<Layout title="Dover & District Beekeepers' Association">
	<div
		class="flex flex-col md:flex-row items-center gap-8 md:gap-12 py-8 md:py-16"
	>
		<!-- Text Content -->
		<div class="flex-1 space-y-6 text-center md:text-left">
			<h1
				class="text-4xl md:text-5xl lg:text-6xl font-bold text-amber-600 leading-tight"
			>
				Welcome to Dover & District Beekeepers
			</h1>

			<p
				class="text-lg md:text-xl text-gray-700 dark:text-gray-200 leading-relaxed max-w-2xl"
			>
				Are you interested in keeping bees? Want to know more about honey? Think
				you've spotted an Asian Hornet? Have a swarm in your garden?
			</p>

			<p class="text-lg text-gray-700 dark:text-gray-400 font-medium">
				Then you're in the correct place! Please explore our website to find out
				more.
			</p>

			<!-- CTA Buttons -->
			<div
				class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-4"
			>
				<a
					href="/membership"
					class="inline-block px-8 py-3 bg-amber-600 text-white font-semibold rounded-lg shadow-md hover:bg-amber-700 transition-colors text-center"
				>
					Join Us
				</a>
				<a
					href="/hornets"
					class="inline-block px-8 py-3 bg-white text-amber-900 border-2 border-amber-900 font-semibold rounded-lg shadow-sm hover:bg-amber-50 transition-colors text-center"
				>
					Report Asian Hornet sighting
				</a>
				<a
					href="/contact"
					class="inline-block px-8 py-3 bg-gray-800 text-white font-semibold rounded-lg shadow-md hover:bg-gray-900 transition-colors text-center"
				>
					Contact Us
				</a>
			</div>
		</div>

		<!-- Hero Image -->
		<div class="flex-1 w-full max-w-lg md:max-w-none">
			<img
				src={bee.src}
				alt="Honey bee on a flower"
				class="w-full h-auto rounded-2xl shadow-xl transform hover:scale-[1.02] transition-transform duration-300"
			/>
		</div>
	</div>

	<!-- Features / Quick Links Section -->
	<div class="grid md:grid-cols-3 gap-8 py-12 border-t border-gray-200 mt-12">
		<!-- Latest News -->
		{
			latestNews && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">Latest News</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(latestNews.data.pubDate)}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{latestNews.data.title}
					</p>
					<p class="text-gray-600 dark:text-gray-300 mb-4 text-sm">
						{latestNews.data.description}
					</p>
					<a
						href={`/news/${latestNews.slug}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						Read more &rarr;
					</a>
				</div>
			)
		}

		<!-- Most Recent Past Meeting -->
		{
			latestPastMeeting && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">
						Most Recent Meeting
					</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(latestPastMeeting.data.date)}
						{latestPastMeeting.data.time && ` • ${latestPastMeeting.data.time}`}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{latestPastMeeting.data.title}
					</p>
					<p class="text-gray-600 dark:text-gray-300 mb-4 text-sm">
						{latestPastMeeting.data.description}
					</p>
					<a
						href={`/meetings/${latestPastMeeting.slug}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						View details &rarr;
					</a>
				</div>
			)
		}

		<!-- Next Upcoming Meeting -->
		{
			nextMeeting && (
				<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
					<h3 class="text-xl font-bold text-amber-600 mb-3">Next Meeting</h3>
					<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
						{formatDate(nextMeeting.data.date)}
						{nextMeeting.data.time && ` • ${nextMeeting.data.time}`}
					</p>
					<p class="font-semibold text-gray-800 dark:text-gray-100 mb-2">
						{nextMeeting.data.title}
					</p>
					<p class="text-gray-600 dark:text-gray-300 mb-4 text-sm">
						{nextMeeting.data.description}
					</p>
					<a
						href={`/meetings/${nextMeeting.slug}`}
						class="text-amber-600 dark:text-amber-500 font-semibold hover:underline"
					>
						View details &rarr;
					</a>
				</div>
			)
		}
	</div>
</Layout>
